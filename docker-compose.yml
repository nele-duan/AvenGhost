version: '3.8'

services:
  avenghost:
    build: .
    container_name: avenghost
    restart: unless-stopped
    volumes:
      - ./data:/app/data
      - ./workspace:/app/workspace
      - ./scripts:/app/scripts
      - ./.env:/app/.env
      # [IDENTITY] Mount Source Code (Live Edit)
      - .:/app
      # "God Mode" mappings (Gives agent control over Docker and System)
      - /var/run/docker.sock:/var/run/docker.sock
      # [TRUE FREEDOM] Mount the entire Host Filesystem
      - /:/mnt/host
      # [IDENTITY] Mount User Identity for Git
      - ~/.ssh:/root/.ssh:ro
      - ~/.gitconfig:/root/.gitconfig.host:ro
    privileged: true
    pid: "host"
    # [DEV MODE] Copy gitconfig so it is writable, then run
    command: sh -c "cp /root/.gitconfig.host /root/.gitconfig || true && npm install && npm run dev"
    # environment:
    # You can override .env here if needed
    # - TELEGRAM_BOT_TOKEN=...
